import{r as e,d as t,h as l,g as s}from"./p-a0a329c6.js";import"./p-c76dc032.js";import"./p-777a3b09.js";import{l as a}from"./p-98a3b9a5.js";import{e as i,s as o}from"./p-fbf9cfd5.js";import{g as r}from"./p-22de27ed.js";const n=[{proc_id:1,proc_name:"Forschungsantrag",proc_roles:[{proc_role_id:1,proc_role_name:"Antragstellender Professor"},{proc_role_id:2,proc_role_name:"Mitarbeitender Professor"},{proc_role_id:3,proc_role_name:"Wissenschaftlicher Mitarbeiter"},{proc_role_id:4,proc_role_name:"Technischer Mitarbeiter"},{proc_role_id:5,proc_role_name:"Wissenschaftliche Hilfskraft"}]},{proc_id:2,proc_name:"Forschungsmonitoring",proc_roles:[{proc_role_id:1,proc_role_name:"Verantwortlicher Professor"},{proc_role_id:2,proc_role_name:"Forschende Person"},{proc_role_id:3,proc_role_name:"Verantwortlicher Wissenschaftlicher Mitarbeiter"}]},{proc_id:3,proc_name:"Interne Veranstaltung",proc_roles:[{proc_role_id:1,proc_role_name:"Organisator"},{proc_role_id:2,proc_role_name:"Referent"},{proc_role_id:3,proc_role_name:"Teilnemende Person"}]}],d=class{constructor(l){e(this,l),this.completed=t(this,"completed",7),this.baseUrl="",this.selectedDataCategory="",this.selectedData=[],this.searchTerms=[],this.dataTemplates=[],this.tmpDataSets=[],this.dataSets=[],this.favoredPersons=[],this.editActive=!1,this.selectedProcessing="",this.selectedPersonCategorie="Alle",this.seachString="",this.selectedTemplateBeforeEdit="",this.isPersonTableSelectAll=!1}getProcessings(){return n}getHigherOrderCategoriesOfCategoriesOfData(){let e=r(o.dbEDataCategory);return e=e.sort((function(e,t){return e.friendlyName<t.friendlyName?-1:t.friendlyName>e.friendlyName?1:0})),e}getSelectedData(){return this.selectedData}addSelectedDataCategory(e){this.selectedData.find((t=>t.id.value===e.id.value))||(this.selectedData=[...this.selectedData,e])}removeSelectedDataCategory(e){this.selectedData.find((t=>t.id.value==e.id.value))&&(this.selectedData=this.selectedData.filter((t=>t.id.value!==e.id.value)))}getPersons(){var e=[];return i.forEach((t=>{t.person_name=t.first_name+" "+t.last_name,t.person_fakultaet={id:1,name:"Wirtschaftswissenschaften"},t.person_stelle=["Professor"],e.push(t)})),e.sort((function(e,t){return e.person_name<t.person_name?-1:t.person_name>e.person_name?1:0}))}getPersonCategories(){let e=["Alle"];return this.getPersons().forEach((t=>{t.person_stelle.forEach((t=>{e.includes(t)||e.push(t)})),e.includes(t.person_fakultaet.name)||e.push(t.person_fakultaet.name)})),e}getPersonFaculties(){let e=["Alle"];return this.getPersons().forEach((t=>{e.includes(t.person_fakultaet.name)||e.push(t.person_fakultaet.name)})),e}getPersonRoles(){let e=["Alle"];return this.getPersons().forEach((t=>{t.person_stelle.forEach((t=>{e.includes(t)||e.push(t)}))})),e}getCategoriesOfData(){var e=o.dbEDataCategory.filter((e=>!r(o.dbEDataCategory).find((t=>t.id.value===e.id.value))));return e.sort((function(e,t){return e.friendlyName<t.friendlyName?-1:t.friendlyName>e.friendlyName?1:0}))}appendDataSet(e){if(void 0!==e)if(0==this.tmpDataSets.filter((t=>t.person.person_id==e.person_id)).length)this.tmpDataSets=[...this.tmpDataSets,{person:e,data:this.selectedData,id:Math.random().toString(36).substr(2,9)}];else for(let t of this.tmpDataSets)t.person.person_id==e.person_id&&(t.pii=[...this.selectedData])}getPersonById(e){return this.getPersons().find((t=>t.person_id==e)).person_name}deleteTmpSelectedPerson(e){let t=this.tmpDataSets.filter((t=>t.person.person_id!=e.person_id));this.tmpDataSets=[...t]}deleteSelectedPerson(e){let t=this.dataSets.filter((t=>t.person.person_id!=e.person_id));this.dataSets=[...t]}checkPerson(e,t){e.target.checked?this.appendDataSet(t):this.deleteTmpSelectedPerson(t)}isPersonChecked(e){let t=!1;return this.tmpDataSets.forEach((l=>{l.person.person_id==e.person_id&&(t=!0)})),t}checkCategory(e,t){e.target.checked?this.getPersons().forEach((e=>{(e.person_stelle.toString().includes(t)||e.person_fakultaet.name==t||"Alle"==t)&&(this.isPersonChecked(e)||this.appendDataSet(e))})):this.getPersons().forEach((e=>{(this.isPersonChecked(e)&&e.person_stelle.toString().includes(t)||e.person_fakultaet.name==t||"Alle"==t)&&this.deleteTmpSelectedPerson(e)}))}favorPerson(e,t){if(e.target.checked)if(this.favoredPersons.includes(t.person_id)){let e=this.favoredPersons.filter((e=>e.person.person_id!=t.person_id));this.favoredPersons=e}else this.favoredPersons.push(t.person_id);else this.favoredPersons.push(t.person_id)}isCategoryChecked(e){let t=!0;return this.getPersons().forEach((l=>{(l.person_stelle.toString().includes(e)||l.person_fakultaet.name==e||"Alle"==e)&&0==this.isPersonChecked(l)&&(t=!1)})),t}isPersonFavored(e){return this.favoredPersons.includes(e.person_id)}activateSet(e){this.selectedDataSet=e,this.selectedDataBeforeEdit=this.selectedData,this.selectedData=[...e.data]}activateEditMode(){this.editActive=!0,this.selectedTemplateBeforeEdit=document.getElementById("templateSelect").value,document.getElementById("templateSelect").value="0"}deactivateEditMode(){this.appendDataSet(this.selectedDataSet.person),this.selectedData=this.selectedDataBeforeEdit,this.selectedDataBeforeEdit=null,this.selectedDataSet=null,this.editActive=!1,document.getElementById("templateSelect").value=this.selectedTemplateBeforeEdit}getSelectedPersonTypes(){return""!=this.selectedProcessing?this.getProcessings().find((e=>e.proc_name==this.selectedProcessing)).proc_roles:[]}addExternPerson(){let e=document.getElementById("vorname").value,t=document.getElementById("nachname").value,l={person_email_adresse:document.getElementById("email-adresse").value,person_name:e+" "+t,person_id:"_"+Math.random().toString(36).substr(2,9)},s=[...this.selectedData,{data_name:"E-Mail-Adresse"}];if(0==this.tmpDataSets.filter((e=>e.person.person_name==l.person_name)).length)this.tmpDataSets=[...this.tmpDataSets,{person:l,data:s,id:Math.random().toString(36).substr(2,9)}];else for(let e of this.tmpDataSets)e.person.person_name==l.person_name&&(e.pii=[...s]);document.getElementById("vorname").value="",document.getElementById("nachname").value="",document.getElementById("email-adresse").value=""}saveTmpDataSets(){let e=document.getElementById("dataDatePicker").value;""==e&&(e="latest"),null!=this.tmpDataSets&&this.tmpDataSets.length>0&&(this.tmpDataSets.forEach((t=>{if(t.data.forEach((t=>{t.data_date=e})),0==this.dataSets.length)this.dataSets=[...this.dataSets,t];else if(0==this.dataSets.filter((e=>e.person.person_name==t.person.person_name)).length)this.dataSets=[...this.dataSets,t];else{let e=this.dataSets.find((e=>e.person.person_name==t.person.person_name)).data;t.data.forEach((t=>{var l=!0;e.forEach((e=>{t.data_name==e.data_name&&t.data_date==e.data_date&&(l=!1)})),l&&(e=[...e,t])})),this.dataSets.find((e=>e.person.person_name==t.person.person_name)).pii=e}})),this.tmpDataSets=[],this.selectedData=[])}saveDataTemplate(){let e={template_name:document.getElementById("dataTemplateName").value,template_data:[...this.selectedData]};this.dataTemplates.push(e),document.getElementById("dataTemplateName").value=""}componentWillRender(){}render(){return l("div",{class:"container-fluid"},l("div",{class:"card"},l("div",{class:"card-body"},l("div",{class:"row border pt-2"},l("div",{class:"col border-right"},l("h5",null,"Schnellauswahl"),l("ul",{class:"list-group personal-data-query-views border-start border-end rounded"},this.getHigherOrderCategoriesOfCategoriesOfData().map((e=>l("a",{href:"javascript:void(0);",onClick:()=>this.selectedDataCategory=e.id.value,class:"list-group-item list-group-item-action d-flex justify-content-between align-items-center"},e.friendlyName))))),l("div",{class:"col"},l("h5",null,"Alle"),l("ul",{class:"list-group personal-data-query-views border-start border-end rounded border-0"},this.getCategoriesOfData().map((e=>l("li",{class:"list-group-item"},l("input",{class:"form-check-input pr-1 me-1",type:"checkbox",onClick:t=>t.target.checked?this.addSelectedDataCategory(e):this.removeSelectedDataCategory(e),checked:!!this.selectedData.find((t=>t.id.value===e.id.value)),"aria-label":"..."}),e.friendlyName))))),l("div",{class:"col shadow p-2 mb-3 bg-white rounded"},l("h5",{class:"font-weight-light"},"Auswahl",this.selectedDataSet&&this.editActive?" für "+this.selectedDataSet.person.person_name:""),l("ul",{class:"list-group list-group-flush personal-data-query-views data-result border-0"},this.getSelectedData().map((e=>l("li",{class:"list-group-item d-flex justify-content-between align-items-center"},e.friendlyName,l("button",{type:"button",onClick:()=>this.removeSelectedDataCategory(e),class:"btn close","aria-label":"Close"},l("span",{"aria-hidden":"true"},"×")))))),l("select",{id:"templateSelect",class:"form-control",onChange:e=>this.selectedData=this.dataTemplates.find((t=>t.template_name==e.target.value)).template_data},l("option",{selected:!0,disabled:!0,value:"0"},"Daten Vorlage wählen"),this.dataTemplates.map((e=>l("option",{value:e.template_name},e.template_name)))),l("div",{class:"card"},this.editActive?"":l("button",{type:"button",class:"btn btn-primary btn-sm",disabled:this.selectedData.length<1,"data-toggle":"modal","data-target":"#Modal_NewTemplate"},"Auswahl als Vorlage speichern"),this.editActive?l("button",{class:"btn btn-primary ",onClick:()=>this.deactivateEditMode()},"Speichern"):""))),l("div",{class:"modal fade",id:"Modal_NewTemplate",tabindex:"-1",role:"dialog","aria-labelledby":"Modal_NewTemplateTitle","aria-hidden":"true"},l("div",{class:"modal-dialog modal-dialog-centered",role:"document"},l("div",{class:"modal-content"},l("div",{class:"modal-header"},l("h5",{class:"modal-title",id:"Modal_NewTemplateTitle"},"Neue Datenvorlage"),l("button",{type:"button",class:"btn close","data-dismiss":"modal","aria-label":"Close"},l("span",{"aria-hidden":"true"},"×"))),l("div",{class:"modal-body"},l("div",{class:"input-group mb-3"},l("input",{id:"dataTemplateName",type:"text",class:"form-control",placeholder:"Name","aria-label":"Name"})),l("button",{onClick:()=>this.saveDataTemplate(),class:"btn btn-primary float-right",type:"button","data-dismiss":"modal"},"Hinzufügen"))))),l("div",{class:"row border pt-2"},l("div",{class:"col-12"},l("h5",null,"1.3 Auswahl betroffener Personen")),l("div",{class:"col-12"},"Von wem benötigen Sie die ausgewählten personenbezogenen Daten?"),l("div",{class:"row"},l("div",{class:"col-12"},l("input",{class:"form-control",id:"person_search",type:"search",placeholder:"Suche",onKeyUp:()=>this.seachString=document.getElementById("person_search").value})),l("div",{class:"col-4"},l("label",null,"Fakultät / Hochschuleinheit"),l("ui5-multi-combobox",{"onSelection-change":()=>alert("TODO: implement filter")},this.getPersonFaculties().map((e=>l("ui5-mcb-item",{text:e,selected:"Alle"===e||null},"Professor"))))),l("div",{class:"col-4"},l("label",null,"Rolle"),l("br",null),l("ui5-multi-combobox",{"onSelection-change":()=>alert("TODO: implement filter")},this.getPersonRoles().map((e=>l("ui5-mcb-item",{text:e,selected:"Alle"===e||null}))))),l("div",{class:"col-4"},l("label",null,"Standort"),l("br",null),l("ui5-multi-combobox",{"onSelection-change":()=>alert("TODO: implement filter")},this.getPersonRoles().map((e=>l("ui5-mcb-item",{text:e,selected:"Alle"===e||null}))))))),l("div",{class:"row border pt-2"},l("div",{class:"col"},l("div",{class:"person-table"},l("table",{class:"table table-hover table-sm"},l("thead",null,l("tr",null,l("th",{scope:"col"},l("input",{type:"checkbox",disabled:this.editActive||0==this.selectedData.length,onClick:()=>alert("TODO"),"aria-label":"..."})),l("th",{scope:"col"},"Name"),l("th",{scope:"col"},"Fakultät / Hochschuleinheit"))),l("tbody",null,this.getPersons().filter((e=>(e.person_stelle.includes(this.selectedPersonCategorie)||e.person_fakultaet.name==this.selectedPersonCategorie||"Alle"==this.selectedPersonCategorie)&&(e.person_name.toLowerCase().includes(this.seachString.toLowerCase())||e.person_fakultaet.name.toLowerCase().includes(this.seachString.toLowerCase())||e.person_stelle.toString().toLowerCase().includes(this.seachString.toLowerCase())))).map((e=>l("tr",null,l("td",null,l("div",null,l("input",{type:"checkbox",disabled:this.editActive||0==this.selectedData.length,onClick:t=>this.checkPerson(t,e),checked:this.isPersonChecked(e),"aria-label":"..."}))),l("td",null,e.person_name," (",e.person_title,")"),l("td",null,e.person_fakultaet.name))))))))),l("div",null,l("p",null,l("button",{class:"btn btn-primary float-right",type:"button","data-toggle":"collapse","data-target":"#collapseExample","aria-expanded":"false","aria-controls":"collapseExample"},l("i",{class:"fas fa-user-plus"})," Externe Person Hinzufügen")),l("div",{class:"collapse",id:"collapseExample"},l("div",{class:"card card-body "},l("div",{class:"input-group mb-3"},l("input",{id:"vorname",type:"text",class:"form-control",placeholder:"Vorname","aria-label":"Vorname"})),l("div",{class:"input-group mb-3"},l("input",{id:"nachname",type:"text",class:"form-control",placeholder:"Nachname","aria-label":"Nachname"})),l("div",{class:"input-group mb-3"},l("input",{id:"email-adresse",type:"email",class:"form-control",placeholder:"E-Mail-Adresse","aria-label":"E-Mail-Adresse"})),l("button",{onClick:()=>this.addExternPerson(),class:"btn btn-primary float-right",type:"button","data-toggle":"collapse","data-target":"#collapseExample","aria-expanded":"false","aria-controls":"collapseExample"},"Hinzufügen")))),l("div",{class:"row mt-5"},l("h4",{class:"font-weight-light"},"Ausgewählte Daten und Personen")),l("div",{class:"row mt-4 d-flex justify-content-between"},l("h5",{class:"font-weight-light"},"Temporäre Auswahl")),l("div",{class:"row"},this.tmpDataSets.length>0?l("ul",{class:"list-group w-100"},this.tmpDataSets.map((e=>l("div",null,l("li",{class:"list-group-item list-group-item-action d-flex justify-content-between align-items-center "},l("div",{class:"col"},e.person.person_name),l("div",{class:"col"},l("span",{class:"badge badge-light float-left","data-toggle":"tooltip","data-placement":"right",title:e.person.person_name},"Gewählte Daten: ",e.data.length)),l("div",{class:"col"},l("div",{class:"d-flex justify-content-end"},l("button",{type:"button",class:"btn btn-outline-secondary btn-sm","data-toggle":"modal","data-target":"#Modal_"+e.id},"Info"),l("button",{type:"button",onClick:()=>{this.activateSet(e),this.activateEditMode()},class:"btn btn-outline-secondary btn-sm"},"Bearbeiten"),l("button",{type:"button",class:"btn btn-outline-secondary btn-sm","data-toggle":"modal","data-target":"#exampleModalCenter"},"Historie"),l("button",{type:"button",onClick:()=>this.deleteTmpSelectedPerson(e.person),class:"btn close","aria-label":"Close"},l("span",{"aria-hidden":"true"},"×"))))),l("div",{class:"modal fade",id:"Modal_"+e.id,tabindex:"-1",role:"dialog","aria-labelledby":"Modal_"+e.id+"Title","aria-hidden":"true"},l("div",{class:"modal-dialog modal-dialog-centered",role:"document"},l("div",{class:"modal-content"},l("div",{class:"modal-header"},l("h5",{class:"modal-title",id:"Modal_"+e.id+"Title"},e.person.person_name),l("button",{type:"button",class:"btn close","data-dismiss":"modal","aria-label":"Close"},l("span",{"aria-hidden":"true"},"×"))),l("div",{class:"modal-body"},l("ul",null,e.data.map((e=>l("li",null,e.data_name)))))))))))):l("p",{class:"text-center font-italic w-100"},"Bitte Daten auswählen und einer Person zuordnen")),l("div",{class:"row"},l("div",{class:"card card-body"},l("div",{class:"form-inline"},l("div",{class:"input-group"},l("label",{htmlFor:"dataDatePicker",class:"col-form-label mr-2 font-weight-light"},"Version der Daten:"),l("ui5-date-picker",{id:"dataDatePicker",placeholder:"MM JJJJ","format-pattern":"MM yyyy"}))),l("button",{class:"btn btn-primary",type:"button",onClick:()=>this.saveTmpDataSets()},"Speichern"))),l("div",{class:"row mt-5"},l("h5",{class:"font-weight-light"},"Finale Auswahl")),l("div",{class:"row"},this.dataSets.length>0?l("ul",{class:"list-group w-100"},this.dataSets.map((e=>l("div",null,l("li",{class:"list-group-item list-group-item-action d-flex justify-content-between align-items-center "},l("div",{class:"col"},e.person.person_name),l("div",{class:"col"},l("span",{class:"badge badge-light float-left","data-toggle":"tooltip","data-placement":"right",title:e.person.person_name},"Gewählte Daten: ",e.data.length)),l("div",{class:"col"},l("div",{class:"d-flex justify-content-end"},l("button",{type:"button",class:"btn btn-outline-secondary btn-sm","data-toggle":"modal","data-target":"#Modal__"+e.id},"Info"),l("button",{type:"button",class:"btn btn-outline-secondary btn-sm","data-toggle":"modal","data-target":"#exampleModalCenter"},"Historie"),l("button",{type:"button",onClick:()=>this.deleteSelectedPerson(e.person),class:"btn close","aria-label":"Close"},l("span",{"aria-hidden":"true"},"×"))))),l("div",{class:"modal fade",id:"Modal__"+e.id,tabindex:"-1",role:"dialog","aria-labelledby":"Modal__"+e.id+"Title","aria-hidden":"true"},l("div",{class:"modal-dialog modal-dialog-centered",role:"document"},l("div",{class:"modal-content"},l("div",{class:"modal-header"},l("h5",{class:"modal-title",id:"Modal__"+e.id+"Title"},e.person.person_name),l("button",{type:"button",class:"btn close","data-dismiss":"modal","aria-label":"Close"},l("span",{"aria-hidden":"true"},"×"))),l("div",{class:"modal-body"},l("ul",null,e.data.map((e=>l("li",null,e.data_name," (","latest"!=e.data_date?e.data_date:"aktuellste",")")))))))))))):l("p",{class:"text-center font-italic w-100"},"Bitte temporäre Auswahl speichern")),l("div",{class:"modal fade",id:"exampleModalCenter",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalCenterTitle","aria-hidden":"true"},l("div",{class:"modal-dialog modal-dialog-centered",role:"document"},l("div",{class:"modal-content"},l("div",{class:"modal-header"},l("h5",{class:"modal-title",id:"exampleModalLongTitle"},"Historie"),l("button",{type:"button",class:"btn close","data-dismiss":"modal","aria-label":"Close"},l("span",{"aria-hidden":"true"},"×"))),l("div",{class:"modal-body"},l("table",{class:"table table-hover"},l("thead",null,l("tr",null,l("th",{scope:"col"},"#"),l("th",{scope:"col"},"Vorgang"),l("th",{scope:"col"},"Datum"),l("th",{scope:"col"},"Status"))),l("tbody",null,l("tr",null,l("th",{scope:"row"},"1"),l("td",null,"Einstellung"),l("td",null,"01.02.2005"),l("td",null,"Abgeschlossen")),l("tr",null,l("th",{scope:"row"},"2"),l("td",null,"Forschungsantrag"),l("td",null,"20.03.2007"),l("td",null,"Abgeschlossen")),l("tr",null,l("th",{scope:"row"},"3"),l("td",null,"Vertragsverlängerung"),l("td",null,"03.02.2010"),l("td",null,"Abgeschlossen"))))),l("div",{class:"modal-footer"})))),l("div",{class:"row pt-3"},l("div",{class:"col d-flex flex-row-reverse bd-highlight"},l("button",{onClick:()=>this.completed.emit({dataSets:this.dataSets,processing:this.selectedProcessing}),type:"button",class:"btn btn-success float-right",disabled:this.dataSets.length<1,"data-toggle":"collapse","data-target":".multi-collapse","aria-expanded":"true","aria-controls":"collapseOne collapseTwo"},a.btnNext))))))}get el(){return s(this)}static get watchers(){return{selectedData:["getSelectedData"]}}};d.route="/vorlagen/datenkorb",d.style='.sc-trusd-piiq-com-data-basket-permission-step-2-h{display:block}.personal-data-query-views.sc-trusd-piiq-com-data-basket-permission-step-2{height:300px;margin-bottom:10px;overflow:scroll;-webkit-overflow-scrolling:touch}*.sc-trusd-piiq-com-data-basket-permission-step-2{text-align:left}.star.sc-trusd-piiq-com-data-basket-permission-step-2{visibility:hidden;cursor:pointer;font-size:20px;right:0;margin-right:10px;top:5px;left:auto}.star.sc-trusd-piiq-com-data-basket-permission-step-2:before{content:"\\2606";position:absolute;visibility:visible}.star.sc-trusd-piiq-com-data-basket-permission-step-2:checked:before{content:"\\2605";position:absolute}.calDayContainer.sc-trusd-piiq-com-data-basket-permission-step-2{bottom:100%}.person-table.sc-trusd-piiq-com-data-basket-permission-step-2{height:200px;overflow:auto}#exTab2.sc-trusd-piiq-com-data-basket-permission-step-2 h3.sc-trusd-piiq-com-data-basket-permission-step-2{color:white;background-color:#428bca;padding:5px 15px}';export{d as D}