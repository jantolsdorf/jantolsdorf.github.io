const e={defaultDuration:400,element:document.createElement("DIV"),identity:()=>{}},t=new WeakMap;class n{static get tasks(){return t}static enqueue(e,n){t.has(e)||t.set(e,[]),t.get(e).push(n)}static run(e,r){return t.has(e)||t.set(e,[]),r().then((()=>{const r=t.get(e);if(r.length>0)return n.run(e,r.shift());t.delete(e)}))}static push(e,r){t.get(e)?n.enqueue(e,r):n.run(e,r)}}const r=({beforeStart:t=e.identity,duration:r=e.defaultDuration,element:s=e.element,progress:a=e.identity})=>{let o,i,u,c=null,m=!1;const l=new Promise(((e,t)=>{u=t=>{c=c||t;const n=t-c;n<=r?(a(1-(r-n)/r),o=!m&&requestAnimationFrame(u)):(a(1),e())},i=()=>{m=!0,cancelAnimationFrame(o),t(new Error("animation stopped"))}})).catch((e=>e));return n.push(s,(()=>(t(),requestAnimationFrame(u),new Promise((e=>{l.then((()=>e()))}))))),{promise:()=>l,stop:()=>i}};export{e as a,r as b}