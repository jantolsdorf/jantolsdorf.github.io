import{s as t}from"./p-fbf9cfd5.js";import{c as e,i as s}from"./p-22de27ed.js";import{E as a,v as i,V as n}from"./p-6ac8576c.js";class r{constructor({activity_type:t,activity_date:e,created_person:s="",changed_person:a="",changed_description:i="",consent_data:n="",consent_person:r="",consent_state:c=!1,data_name:h="",data_author:o="",data_person_name:d="",message_from:D="",message_to:_=""}){this.activity_type=t,this.activity_date=e,this.created_person=s,this.changed_person=a,this.changed_description=i,this.consent_data=n,this.consent_person=r,this.consent_state=c,this.data_name=h,this.data_author=o,this.data_person_name=d,this.message_from=D,this.message_to=_}}var c,h,o,d,D;!function(t){t.CREATED="CREATED",t.CHANGED="CHANGED",t.CONSENT="CONSENT",t.DATA="DATA",t.MESSAGE="MESSAGE"}(c||(c={}));class _{constructor(){this.activities=[]}addCreated(t){this.activities.push(new r({activity_type:c.CREATED,activity_date:(new Date).getTime().toString(),created_person:t}))}addChange(t,e){this.activities.push(new r({activity_type:c.CHANGED,activity_date:(new Date).getTime().toString(),changed_person:t,changed_description:e}))}addConsent(t,e,s){this.activities.push(new r({activity_type:c.CONSENT,activity_date:(new Date).getTime().toString(),consent_person:t,consent_data:e,consent_state:s}))}addData(t,e,s){this.activities.push(new r({activity_type:c.DATA,activity_date:(new Date).getTime().toString(),data_author:t,data_name:s,data_person_name:e}))}addMessage(t,e){this.activities.push(new r({activity_type:c.MESSAGE,activity_date:(new Date).getTime().toString(),message_from:t,message_to:e}))}}!function(t){t.EMAIL="EMAIL",t.INHOUSE_MAIL="INHOUSE_EMAIL",t.FILE_UPLOAD="FILE_UPLOAD",t.FAX="FAX"}(h||(h={})),function(t){t.DRAFTING="DRAFTING",t.ACTIVE="ACTIVE",t.DONE="DONE",t.IDLE="IDLE"}(o||(o={})),function(t){t.WAITING="WAITING",t.READY="READY"}(d||(d={})),function(t){t.TEMPLATE="TEMPLATE",t.DATABASKET="DATABASKET"}(D||(D={}));class l{constructor(){this.ID="",this.title="",this.status=o.DRAFTING,this.state=d.WAITING,this.type=D.DATABASKET,this.requestingDataProcessor=Object.assign(Object.assign({},new a),{first_name:"Verena",last_name:"Wagner-MÃ¼ller",faculty:"R01 Wissenschafts- und Technologietransfer"}),this.selectedProcessingRecordID="",this.topicAssignments=[],this.template="",this.dataSets=[],this.deadline="",this.description="",this.processing="",this.transmissionChannel=[],this.lastActionDate="",this.numMessagesUnread=0,this.numIssues=0,this.progress=0,this.activityLog=new _,this.isNewProcessingRecordEntry=!1,this.progressCompletenessPersonalData=0,this.progressCompletenessConsentByPersonalData=0,this.progressCompletenessPersonalDataOtherDepartment=0,this.progressCompletenessPermissions=0,this.progressCompletenessObjectionsByPersonalData=0,this.progressCompletenessPermissionByPersonalData=0,this.conversation=[],this.isStatusReadyHasBeenConfirmed=!1,this.requestNumOpenResponses=0,this.requestPersonalMessageToDataSubjects="",this.requestPersonalMessageToPersonOrDepartment="",this.requestDataRequestedFrom="DATA_SUBJECT",this.isAskToUpdateOutdatedPII=!1,this.ID=i()}static updateProgress(t){let a=0;return t.progressCompletenessPersonalData=0,t.progressCompletenessPermissions=0,t.progressCompletenessObjectionsByPersonalData=0,t.progressCompletenessConsentByPersonalData=0,t.progressCompletenessPermissionByPersonalData=0,t.progressCompletenessPersonalDataOtherDepartment=0,t.dataSets.forEach((i=>{a+=i.pii.length;let n=l.checkPIIAvailable(i,t);n.elicitedBy===t.requestingDataProcessor.faculty?t.progressCompletenessPersonalData+=n.count:t.progressCompletenessPersonalDataOtherDepartment+=n.count;let r=e(i,t);t.progressCompletenessObjectionsByPersonalData+=r.filter((t=>"OBJECTED"===t)).length,t.progressCompletenessConsentByPersonalData+=r.filter((t=>"ALLOWED"===t)).length,t.progressCompletenessPermissionByPersonalData+=r.filter((t=>"ALLOWED"===t)).length,"ALLOWED"===s(i,t)&&(t.progressCompletenessPermissions+=1)})),t.progressCompletenessPersonalData=Math.trunc(100*t.progressCompletenessPersonalData/a),t.progressCompletenessPersonalDataOtherDepartment=Math.trunc(100*t.progressCompletenessPersonalDataOtherDepartment/a),t.progressCompletenessPermissions=Math.trunc(100*t.progressCompletenessPermissions/t.dataSets.length),t.progressCompletenessObjectionsByPersonalData=Math.trunc(100*t.progressCompletenessObjectionsByPersonalData/a),t.progressCompletenessConsentByPersonalData=Math.trunc(100*t.progressCompletenessConsentByPersonalData/a),t.progressCompletenessPermissionByPersonalData=Math.trunc(100*t.progressCompletenessPermissionByPersonalData/a),t.progress=(t.progressCompletenessPermissions+t.progressCompletenessPersonalData)/2,100==t.progress&&(t.state=d.READY),t.progress<100&&(t.state=d.WAITING),t.lastActionDate=(new Date).toString(),t}static getPIISpecialCategories(t){let e=[];return t.dataSets.map((t=>t.pii.map((t=>{(t.dataCategory.specialCategories&&t.dataCategory.specialCategories.length||t.dataCategory.isCriminalRecord&&1==t.dataCategory.isCriminalRecord)&&e.push(t)})))),e}static checkPIIAvailable(e,s){let a=0,i="";return"INDIVIDUAL"===e.person.type&&e.pii.forEach((n=>{let r=t.dbEPersonalData.find((t=>t.dataSubjectID===e.person.dataSubject.id&&t.dataCategoryID.trim()===n.dataCategory.id.value.trim()&&t.processingRecordEntryID===s.selectedProcessingRecordID));r?(a+=1,i=r.elicitedBy):n.dataCategory.id.value.startsWith("ext-")&&(a+=1,i="R04 Personalservice")})),{count:a,elicitedBy:i}}static checkPIIDeletion(e){let s=[],a=0;return e.dataSets.forEach((i=>{"INDIVIDUAL"===i.person.type&&i.pii.forEach((n=>{let r=t.dbEPersonalData.find((t=>t.dataSubjectID===i.person.dataSubject.id&&t.dataCategoryID.trim()===n.dataCategory.id.value.trim()&&t.processingRecordEntryID===e.selectedProcessingRecordID));if(r){a=new Date(r.updated).getTime()+864e5*r.deletionPeriod;let t=s.findIndex((t=>t.deletionDateMillis.toString()===a.toString()));t>-1?s[t].person.find((t=>t.dataSubject.id===i.person.dataSubject.id))||s[t].person.push(i.person):s.push({deletionDateMillis:a,person:[i.person]})}else n.dataCategory.id.value.startsWith("ext-")}))})),s.sort(((t,e)=>t.deletionDateMillis<e.deletionDateMillis?-1:t.deletionDateMillis>e.deletionDateMillis?1:0))}static IsSinglePIIAvailable(e,s,a){return!!t.dbEPersonalData.find((t=>t.dataSubjectID===s.dataSubject.id&&t.dataCategoryID.trim()===e.dataCategory.id.value.trim()&&t.processingRecordEntryID===a.selectedProcessingRecordID))||!!e.dataCategory.id.value.startsWith("ext-")}static checkOutdatedPII(e,s){let a="UPTODATE";return"INDIVIDUAL"===s.person.type?s.pii.forEach((i=>{if("OUTDATED"===a||"UNKNOWN"===a)return;let n=t.dbEPersonalData.find((t=>t.dataSubjectID===s.person.dataSubject.id&&t.dataCategoryID===i.dataCategory.id.value&&t.processingRecordEntryID===e.selectedProcessingRecordID));a=this.isPIIOudated(n)})):a="UNKNOWN",a}static isPIIOudated(t){let e="UPTODATE";return t&&t.updated?((new Date).getTime()-new Date(t.updated).getTime())/864e5>180&&(e="OUTDATED"):e="UNKNOWN",e}static addToConversations(t,e,s,a){t.conversation||(t.conversation=[]);let i=t.conversation.find((t=>"INDIVIDUAL"===t.dataSubject.type&&t.dataSubject.dataSubject.id===e.dataSubject.id));return i||(i={dataSubject:e,messages:[]}),i.messages=[...i.messages,{message:s,date:(new Date).toLocaleTimeString("de")+" | "+(new Date).toLocaleDateString("de"),sender:a}],t.conversation=[i,...t.conversation.filter((t=>"INDIVIDUAL"===t.dataSubject.type&&t.dataSubject.dataSubject.id!==e.dataSubject.id))],t}static store(e){return t.dbEDataBasket=[e,...t.dbEDataBasket.filter((t=>t.ID!==e.ID))],e}static getBestSourceForPersonalData(e){let s="FROM_OTHER",a="";return e.dataSets.forEach((e=>{"INDIVIDUAL"===e.person.type?e.pii.forEach((i=>{let n=t.dbEPersonalData.find((t=>t.dataSubjectID===e.person.dataSubject.id&&t.dataCategoryID.trim()===i.dataCategory.id.value.trim()));n?(a=""===a?n.elicitedBy:a,s="FROM_OTHER"===s?n.elicitedBy!==a?"DATA_SUBJECT":"FROM_OTHER":s):s="DATA_SUBJECT"})):s="SELF"})),{bestOption:s,elictedBy:a}}static mergeDataSets(t,e){return e.forEach((e=>{if(0==t.length)t=[...t,e];else if(t.find((t=>n.compare(t.person,e.person)))){let s=t.find((t=>n.compare(t.person,e.person))).pii;e.pii.forEach((t=>{var e=!0;s.forEach((s=>{t.dataCategory.id.value===s.dataCategory.id.value&&t.versionDate===s.versionDate&&(e=!1)})),e&&(s=[...s,t])})),t[t.findIndex((t=>n.compare(t.person,e.person)))].pii=s}else t=[...t,e]})),t}}export{o as E,_ as V,d as a,l as b,c,h as d}